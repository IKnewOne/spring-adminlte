<div th:class="'card entityTable ' + ${tableClass}">
  <div class="card-header">
    <h3 class="card-title" th:text="${title}"></h3>
    <div class="card-tools" th:if="${hasSearchButton}">
      <div class="input-group input-group-sm" style="width: 150px">
        <input type="text" id="table_search" name="table_search" class="form-control float-right" placeholder="Search">
        <div class="input-group-append">
          <button id="table_search_button" th:onclick="|tableSearch('${tableClass}');" type="submit" class="btn btn-default">
            <i class="fas fa-search"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="card-body">
    <table class="table table-bordered entity-list-table">
      <thead>
        <tr>
          <th th:each="headerTitle : ${headerTitles}" th:text="${headerTitle}"></th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="row : ${dataset}">
          <td th:each="column : ${row}" th:utext="${column}"></td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="card-footer clearfix">
    <div class="float-left" th:text="${footerPaginationLabel}"></div>
    <ul class="pagination pagination-sm m-0 float-right" th:if="${pagesTotal > 0}">
      <li class="page-item" th:if="${currentPage > 1}">
        <a class="page-link" th:data-pagination-parameter="${pageParameter}" th:data-page-number="${currentPage - 1}" onclick="handlePaginationClick(event); return false;">«</a>
      </li>
      <li class="page-item" th:if="${currentPage > (1 + visiblePagesCount)}">
        <a class="page-link" th:data-pagination-parameter="${pageParameter}" th:data-page-number="1" onclick="handlePaginationClick(event); return false;">1</a>
      </li>
      <li class="page-item" th:each="pageNumber : ${#numbers.sequence(startPage, endPage)}" th:classappend="${currentPage == pageNumber ? 'active' : ''}">
        <a class="page-link" th:data-pagination-parameter="${pageParameter}" th:data-page-number="${pageNumber}" onclick="handlePaginationClick(event); return false;" th:text="${pageNumber}"></a>
      </li>
      <li class="page-item" th:if="${currentPage < (pagesTotal - visiblePagesCount)}">
        <a class="page-link" th:data-pagination-parameter="${pageParameter}" th:data-page-number="${pagesTotal}" onclick="handlePaginationClick(event); return false;" th:text="${pagesTotal}"></a>
      </li>
      <li class="page-item" th:if="${currentPage < pagesTotal}">
        <a class="page-link" th:data-pagination-parameter="${pageParameter}" th:data-page-number="${currentPage + 1}" onclick="handlePaginationClick(event); return false;">»</a>
      </li>
    </ul>
  </div>
</div>

<style>
  .page-link {
    cursor: pointer;
  }
</style>

<script>
  function setSearchString(tableClass) {
    var elem = document.querySelector('.' + tableClass + ' #table_search');
    var urlObject = new URL(window.location.href);
    var searchString = urlObject.searchParams.get('search');
    if (searchString) {
      elem.value = searchString;
    }
  }

  function tableSearch(tableClass) {
    var searchString = document.querySelector('.' + tableClass + ' #table_search').value;
    var urlObject = new URL(window.location.href);
    if (searchString) {
      urlObject.searchParams.set('search', searchString);
    } else {
      urlObject.searchParams.delete('search');
    }
    window.location.href = urlObject.href;
  }

  function switchPage(pageParameter, page) {
    var urlObject = new URL(window.location.href);
    urlObject.searchParams.set(pageParameter, page);
    window.location.href = urlObject.href;
  }

  function handlePaginationClick(event) {
    event.preventDefault();
    var pageParameter = event.target.getAttribute('data-pagination-parameter');
    var pageNumber = event.target.getAttribute('data-page-number');
    switchPage(pageParameter, pageNumber);
  }


  function applyEventListenersToTables() {
    var entityTables = document.querySelectorAll('.entityTable');
    entityTables.forEach(function (table) {
      var tableClass = table.classList[2]; // The class at index 2 is the dynamic class
      setSearchString(tableClass);

      var searchInputElem = table.querySelector('#table_search');
      searchInputElem.addEventListener('keypress', function (event) {
        if (event.key === 'Enter') {
          event.preventDefault();
          table.querySelector('#table_search_button').click();
        }
      });
    });
  }

  document.addEventListener('DOMContentLoaded', function () {
    applyEventListenersToTables();
  }, false);

</script>